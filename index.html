<script>
let canvas = document.getElementById("gameCanvas");
let ctx = canvas.getContext("2d");

let gameRunning = false;
let mode = "1p";
let p1 = { x: 20, y: canvas.height/2 - 30, w: 10, h: 60, dy: 0 };
let p2 = { x: canvas.width-30, y: canvas.height/2 - 30, w: 10, h: 60, dy: 0 };
let puck = { x: canvas.width/2, y: canvas.height/2, r: 8, dx: 3, dy: 2 };

let p1Score = 0, p2Score = 0;

function startGame(selectedMode){
  mode = selectedMode;
  document.getElementById("menu").style.display = "none";
  document.getElementById("scoreboard").style.display = "block";
  resetPositions();
  gameRunning = true;
  requestAnimationFrame(gameLoop);
}

function resetGame(){
  gameRunning = false;
  document.getElementById("menu").style.display = "block";
  document.getElementById("scoreboard").style.display = "none";
  p1Score = p2Score = 0;
  updateScoreboard();
  ctx.clearRect(0,0,canvas.width,canvas.height);
}

function resetPositions(){
  p1.y = canvas.height/2 - p1.h/2;
  p2.y = canvas.height/2 - p2.h/2;
  puck.x = canvas.width/2;
  puck.y = canvas.height/2;
  puck.dx = (Math.random() > 0.5 ? 3 : -3);
  puck.dy = (Math.random() > 0.5 ? 2 : -2);
}

function updateScoreboard(){
  document.getElementById("p1Score").textContent = p1Score;
  document.getElementById("p2Score").textContent = p2Score;
}

function gameLoop(){
  if (!gameRunning) return;
  
  // move paddles
  p1.y += p1.dy;
  p2.y += p2.dy;
  
  // AI control for 1p mode
  if (mode === "1p"){
    if (puck.y < p2.y + p2.h/2) p2.y -= 3;
    else if (puck.y > p2.y + p2.h/2) p2.y += 3;
  }
  
  // move puck
  puck.x += puck.dx;
  puck.y += puck.dy;
  
  // bounce top/bottom
  if (puck.y - puck.r < 0 || puck.y + puck.r > canvas.height) puck.dy *= -1;
  
  // check paddle collisions
  if (puck.x - puck.r < p1.x + p1.w && puck.y > p1.y && puck.y < p1.y + p1.h) {
    puck.dx *= -1;
    puck.x = p1.x + p1.w + puck.r;
  }
  if (puck.x + puck.r > p2.x && puck.y > p2.y && puck.y < p2.y + p2.h) {
    puck.dx *= -1;
    puck.x = p2.x - puck.r;
  }
  
  // scoring
  if (puck.x < 0) {
    p2Score++; updateScoreboard(); resetPositions();
  }
  if (puck.x > canvas.width) {
    p1Score++; updateScoreboard(); resetPositions();
  }
  
  // draw
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle = "black";
  ctx.fillRect(p1.x, p1.y, p1.w, p1.h);
  ctx.fillRect(p2.x, p2.y, p2.w, p2.h);
  ctx.beginPath();
  ctx.arc(puck.x, puck.y, puck.r, 0, Math.PI*2);
  ctx.fill();
  
  requestAnimationFrame(gameLoop);
}

// controls
document.addEventListener("keydown", e=>{
  if (e.key==="w") p1.dy = -4;
  if (e.key==="s") p1.dy = 4;
  if (mode==="2p"){
    if (e.key==="ArrowUp") p2.dy = -4;
    if (e.key==="ArrowDown") p2.dy = 4;
  }
});
document.addEventListener("keyup", e=>{
  if (e.key==="w"||e.key==="s") p1.dy = 0;
  if (e.key==="ArrowUp"||e.key==="ArrowDown") p2.dy = 0;
});
</script>

